# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
name: Java Jar To Zip Publish
run-name: "[${{ (github.event.inputs.push_to_registry == 'true' && github.event.inputs.push_to_github_release == 'true') && 'æ­£å¼ç‰ˆ' || 'æµ‹è¯•ç‰ˆ' }}] Jar ${{ github.event.inputs.tag_name || github.ref_name || 'v-manual' }}  version"

on:
  push:
    branches:
      - 'v*'
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'è¾“å…¥ Release æ ‡ç­¾ (eg: v0.35.1, v0.36.5-alpha.1)'
        required: false
        type: string
        default: 'v-manual'
      skip_tests:
        description: 'æ˜¯å¦è·³è¿‡æµ‹è¯• (true/false)'
        required: true
        type: boolean
        default: false
      java_version:
        description: 'è¾“å…¥ Java ç‰ˆæœ¬ (å¦‚ 8, 11, 17)'
        required: true
        default: '8'
      jar_dir_prefix:
        description: 'JAR æ–‡ä»¶å‰ç¼€ (å¦‚ ws-service æˆ–ç•™ç©º)'
        default: ''
      draft:
        description: 'æ˜¯å¦ä¸ºè‰ç¨¿ Release (true/false)'
        type: boolean
        default: false
      prerelease:
        description: 'æ˜¯å¦ä¸ºé¢„å‘å¸ƒ Release (true/false)'
        type: boolean
        default: false
      push_to_registry:
        description: 'æ˜¯å¦æ¨é€åˆ°é•œåƒä»“åº“'
        required: true
        type: boolean
        default: true
      push_to_github_release:
        description: 'æ˜¯å¦æ¨é€åˆ°Github Release'
        required: true
        type: boolean
        default: true

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      #releases: write
      actions: read
    steps:
      - name: 1.è°ƒè¯•è§¦å‘ä¿¡æ¯
        run: |
          echo "Event Name: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "Tag Name: ${{ github.event.inputs.tag_name || github.ref_name }}"
          echo "Skip Tests: ${{ github.event.inputs.skip_tests || true }}"
          echo "Java Version: ${{ github.event.inputs.java_version ||secrets.JAVA_VERSION|| '8' }}"
          echo "Jar Dir Prefix: ${{ github.event.inputs.jar_dir_prefix || 'ws-service' }}"
          echo "Draft: ${{ github.event.inputs.draft || false }}"
          echo "Prerelease: ${{ github.event.inputs.prerelease || false }}"
          echo "Repository: ${{ github.repository }}"
          echo "SHA: ${{ github.sha }}"

      - name: 2.æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: 3.è®¾ç½®è¾“å…¥å€¼
        run: |
          
          AUTO=false
          
          TAG_NAME="${{ github.event.inputs.tag_name || github.ref_name }}"
          # åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªåŠ¨è§¦å‘ï¼ˆTAG_NAMEä»¥'v'å¼€å¤´ï¼‰
          if [[ "$TAG_NAME" == v* ]]; then
              AUTO=true
          fi
          echo "AUTO=$AUTO" >> $GITHUB_ENV
          SKIP_TESTS="${{ github.event.inputs.skip_tests || true }}"
          JAVA_VERSION="${{ github.event.inputs.java_version ||secrets.JAVA_VERSION|| '8' }}"
          JAR_DIR_PREFIX="${{ github.event.inputs.jar_dir_prefix || 'ws-service' }}"
          DRAFT="${{ github.event.inputs.draft || false }}"
          PRERELEASE="${{ github.event.inputs.prerelease || false }}" 
          PUSH_TO_REGISTRY="${{ github.event.inputs.push_to_registry  || env.AUTO }}"
          PUSH_TO_GITHUB_RELEASE="${{ github.event.inputs.push_to_github_release  ||  env.AUTO  }}"
          echo "TAG_NAME=$TAG_NAME" >> $GITHUB_ENV
          echo "SKIP_TESTS=$SKIP_TESTS" >> $GITHUB_ENV
          echo "JAVA_VERSION=$JAVA_VERSION" >> $GITHUB_ENV
          echo "JAR_DIR_PREFIX=$JAR_DIR_PREFIX" >> $GITHUB_ENV
          echo "DRAFT=$DRAFT" >> $GITHUB_ENV
          echo "PRERELEASE=$PRERELEASE" >> $GITHUB_ENV
          echo "PUSH_TO_REGISTRY=$PUSH_TO_REGISTRY" >> $GITHUB_ENV
          echo "PUSH_TO_GITHUB_RELEASE=$PUSH_TO_GITHUB_RELEASE" >> $GITHUB_ENV
          echo "è®¾ç½®çš„è¾“å…¥å€¼: TAG_NAME=$TAG_NAME, SKIP_TESTS=$SKIP_TESTS, JAVA_VERSION=$JAVA_VERSION, JAR_DIR_PREFIX=$JAR_DIR_PREFIX, DRAFT=$DRAFT, PRERELEASE=$PRERELEASE,PUSH_TO_REGISTRY=$PUSH_TO_REGISTRY,PUSH_TO_GITHUB_RELEASE=$PUSH_TO_GITHUB_RELEASE"

      - name: 4.éªŒè¯ç‰ˆæœ¬å·
        run: |
          echo "å½“å‰ç‰ˆæœ¬å·: $TAG_NAME"
          if ! [[ "$TAG_NAME" =~ ^v[0-9]+\.[0-9]+\.[0-9]+(-[0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*)?(\+[0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*)?$ ]]; then
            echo "âŒ é”™è¯¯ï¼šç‰ˆæœ¬æ ¼å¼å¿…é¡»ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ (ä¾‹å¦‚: v1.2.3, v1.2.3-alpha, v1.2.3+build.123)"
            exit 1
          fi
          echo "ç‰ˆæœ¬å·éªŒè¯é€šè¿‡"

      - name: 5.è®¾ç½® Java ç¯å¢ƒ version=${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'

      - name: 6.ç¼“å­˜ Maven ä¾èµ–
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-maven-

      - name: 7.ä½¿ç”¨ Maven æ„å»ºå¹¶ç”Ÿæˆ JAR
        run: |
          if [ ${{ env.SKIP_TESTS }} ]; then
            echo "è·³è¿‡æµ‹è¯•"
            echo "mvn clean package -B -DskipTests -Dquickly"
            mvn clean package -B -DskipTests -Dquickly
          else
            echo "mvn clean package -B -Dquickly"
            mvn clean package -B -Dquickly
          fi
          echo "Maven æ„å»ºå®Œæˆ"
          echo "åŒ¹é…çš„ JAR æ–‡ä»¶ (*/target/*.jar):"
          find . -type f -path "*/target/*.jar"
          echo "åŒ¹é…çš„ JAR æ–‡ä»¶ (*/${{ env.JAR_DIR_PREFIX  }}/target/*.jar):"
          find . -type f -path "*/${{ env.JAR_DIR_PREFIX  }}/target/*.jar" || echo "æœªæ‰¾åˆ°åŒ¹é…çš„ JAR æ–‡ä»¶"

      - name: 8.åˆ—å‡ºåŒ¹é…çš„ JAR æ–‡ä»¶
        run: |
          if [ "${{ env.JAR_DIR_PREFIX  }}" = "" ]; then
            echo "åŒ¹é…çš„ JAR æ–‡ä»¶ (*/target/*.jar):"
            find . -type f -path "*/target/*.jar" || echo "æœªæ‰¾åˆ°åŒ¹é…çš„ JAR æ–‡ä»¶"
          else
            echo "åŒ¹é…çš„ JAR æ–‡ä»¶ (*/${{ env.JAR_DIR_PREFIX  }}/target/*.jar):"
            find . -type f -path "*/${{ env.JAR_DIR_PREFIX  }}/target/*.jar" || echo "æœªæ‰¾åˆ°åŒ¹é…çš„ JAR æ–‡ä»¶"
          fi

      - name: 9.æ‰“åŒ…æ‰€æœ‰ JAR æ–‡ä»¶æˆ ZIP
        run: |
          if [ "${{ env.JAR_DIR_PREFIX }}" = "" ]; then
            find . -type f -path "*/target/*.jar" -exec zip -j jars-${{ env.TAG_NAME }}.zip {} +
          else
            find . -type f -path "*/${{ env.JAR_DIR_PREFIX  }}/target/*.jar" -exec zip -j jars-${{ env.TAG_NAME }}.zip {} +
          fi
          # -j: ä»…æ‰“åŒ…æ–‡ä»¶ï¼Œä¸ä¿ç•™ç›®å½•ç»“æ„
          # +: å°½é‡å°†å¤šä¸ªæ–‡ä»¶æ”¾å…¥ä¸€ä¸ª zip å‘½ä»¤ï¼Œå‡å°‘è°ƒç”¨æ¬¡æ•°
        shell: bash

      - name: 10.éªŒè¯ ZIP æ–‡ä»¶
        run: |
          ls -la jars-${{ env.TAG_NAME}}.zip
          echo "ZIP æ–‡ä»¶å†…å®¹:"
          unzip -l jars-${{ env.TAG_NAME }}.zip

      - name: 11.è§£å‹ ZIP æ–‡ä»¶
        run: |
          mkdir -p extracted-jars
          unzip jars-${{ env.TAG_NAME }}.zip -d extracted-jars
          echo "è§£å‹åçš„æ–‡ä»¶:"
          ls -la extracted-jars

      - name: 12. å°† JAR æ–‡ä»¶è½¬æ¢ä¸ºç‹¬ç«‹ EXEï¼ˆæ†ç»‘ç§æœ‰ JREï¼Œå®Œå…¨ç‹¬ç«‹è¿è¡Œï¼‰
        run: |
          # ============ ä¸‹è½½ Launch4j ============
          wget --tries=5 --timeout=60 \
            https://pilotfiber.dl.sourceforge.net/project/launch4j/launch4j-3/3.50/launch4j-3.50-linux-x64.tgz?viasf=1 \
            -O /tmp/launch4j.tgz || \
          wget --tries=5 \
            https://sourceforge.net/projects/launch4j/files/launch4j-3/3.50/launch4j-3.50-linux-x64.tgz/download \
            -O /tmp/launch4j.tgz

          tar -xzf /tmp/launch4j.tgz -C /tmp

          sudo apt-get update
          sudo apt-get install -y mingw-w64 g++-mingw-w64-i686 gcc-mingw-w64-i686 binutils-mingw-w64-i686

          ln -sf /usr/bin/i686-w64-mingw32-windres /tmp/launch4j/bin/windres
          ln -sf /usr/bin/i686-w64-mingw32-ld /tmp/launch4j/bin/ld

          # ============ ä¸‹è½½å¹¶æ†ç»‘ç§æœ‰ JREï¼ˆåŠ¨æ€è·å–æœ€æ–° Java 8 Windows x64 JRE ZIPï¼‰ ============
          echo "ğŸ“¦ æ­£åœ¨åŠ¨æ€è·å– Adoptium Temurin Java 8 æœ€æ–° JRE (Windows x64)"

          # ä½¿ç”¨ Adoptium API è·å–æœ€æ–° Java 8 JRE ZIP çš„ç›´æ¥ä¸‹è½½é“¾æ¥
          API_URL="https://api.adoptium.net/v3/assets/latest/8/hotspot?image_type=jre&os=windows&arch=x64&vendor=adoptium"

          DOWNLOAD_URL=$(curl -s "$API_URL" | jq -r '.[0].binary.package.link')

          if [ -z "$DOWNLOAD_URL" ] || [ "$DOWNLOAD_URL" = "null" ]; then
            echo "âŒ API æœªè¿”å›æœ‰æ•ˆä¸‹è½½é“¾æ¥ï¼Œè¯·æ£€æŸ¥ Java 8 æ˜¯å¦ä»æœ‰ JRE ZIP åŒ…"
            echo "API å“åº”:"
            curl -s "$API_URL" | jq .
            exit 1
          fi

          echo "âœ… è·å–åˆ°ä¸‹è½½é“¾æ¥: $DOWNLOAD_URL"
          wget -q "$DOWNLOAD_URL" -O /tmp/jre.zip

          # è§£å‹å¹¶é‡å‘½å
          unzip -q /tmp/jre.zip -d /tmp
          JRE_DIR=$(find /tmp -maxdepth 1 -type d -name "jdk-8*" -o -name "OpenJDK8U-jre*" | head -1)
          if [ -z "$JRE_DIR" ]; then
            echo "âŒ è§£å‹åæœªæ‰¾åˆ° JRE ç›®å½•"
            ls -la /tmp
            exit 1
          fi
          mv "$JRE_DIR" extracted-jars/jre
          echo "âœ… ç§æœ‰ JRE å·²æ†ç»‘åˆ° extracted-jars/jre/ ï¼ˆå¤§å°: $(du -sh extracted-jars/jre | cut -f1)ï¼‰"

          # ============ ç‰ˆæœ¬å¤„ç† ============
          RAW_TAG=${TAG_NAME#v}
          RAW_TAG=${RAW_TAG:-0.0.1}
          CLEAN_VERSION=$(echo "$RAW_TAG" | sed 's/[^0-9.]//g' | sed 's/^\.*//; s/\.*$//; s/\.\.+/\./g')
          CLEAN_VERSION=${CLEAN_VERSION:-0.0.1}

          IFS='.' read -r -a parts <<< "$CLEAN_VERSION"
          major=${parts[0]:-0} minor=${parts[1]:-0} patch=${parts[2]:-0} build=${parts[3]:-0}
          FILE_VERSION="$major.$minor.$patch.$build"
          TXT_VERSION="${TAG_NAME:-v$major.$minor.$patch}"
          echo "ğŸ› ï¸ ç‰ˆæœ¬: FileVersion=$FILE_VERSION, TxtVersion=$TXT_VERSION"

          # ============ ç”Ÿæˆç‹¬ç«‹ EXE ============
          mkdir -p extracted-jars

          for jar_file in extracted-jars/*.jar; do
            [ -f "$jar_file" ] || { echo "âŒ æœªæ‰¾åˆ° JAR æ–‡ä»¶"; exit 1; }
            jar_name=$(basename "$jar_file" .jar)
            exe_file="extracted-jars/${jar_name}.exe"

            abs_jar=$(realpath "$jar_file")
            abs_exe=$(realpath -m "$exe_file")

            main_class=$(unzip -p "$jar_file" META-INF/MANIFEST.MF | grep '^Main-Class:' | sed 's/^Main-Class: *//' | tr -d '\r')
            [ -z "$main_class" ] && echo "âš ï¸ $jar_file æ—  Main-Classï¼Œè·³è¿‡" && continue

            config_file="/tmp/launch4j_${jar_name}_config.xml"
            cat > "$config_file" << EOF
          <launch4jConfig>
            <dontWrapJar>false</dontWrapJar>
            <headerType>console</headerType>
            <jar>$abs_jar</jar>
            <outfile>$abs_exe</outfile>
            <errTitle>WsProxy Error</errTitle>
            <classPath>
              <mainClass>$main_class</mainClass>
            </classPath>
            <jre>
              <path>jre</path>                               <!-- å…³é”®ï¼šä½¿ç”¨åŒç›®å½•çš„ jre æ–‡ä»¶å¤¹ -->
              <minVersion>${{ env.JAVA_VERSION }}.0</minVersion>
              <maxVersion>${{ env.JAVA_VERSION }}.999</maxVersion>
              <requiresJdk>false</requiresJdk>
              <jdkPreference>preferBundled</jdkPreference>    <!-- ä¼˜å…ˆä½¿ç”¨æ†ç»‘çš„ JRE -->
            </jre>
            <versionInfo>
              <fileVersion>$FILE_VERSION</fileVersion>
              <txtFileVersion>$TXT_VERSION</txtFileVersion>
              <productVersion>$FILE_VERSION</productVersion>
              <txtProductVersion>$TXT_VERSION</txtProductVersion>
              <fileDescription>WsProxy Standalone (Java ${{ env.JAVA_VERSION }})</fileDescription>
              <copyright>Copyright (c) 2023-2026</copyright>
              <productName>WsProxy</productName>
              <internalName>${jar_name}</internalName>
              <originalFilename>${jar_name}.exe</originalFilename>
            </versionInfo>
          </launch4jConfig>
          EOF

            echo "âœ… æ­£åœ¨ç”Ÿæˆå®Œå…¨ç‹¬ç«‹ EXE: $exe_file (å¸¦ç§æœ‰ JRE)"
            java -Djava.awt.headless=true -jar /tmp/launch4j/launch4j.jar "$config_file"

            if [ -f "$exe_file" ]; then
              echo "ğŸ‰ğŸ‰ğŸ‰ æˆåŠŸç”Ÿæˆç‹¬ç«‹è¿è¡Œ EXE: $exe_file (å¤§å°: $(du -h "$exe_file" | cut -f1))"
            else
              echo "âŒ ç”Ÿæˆå¤±è´¥"
              cat /tmp/launch4j/launch4j.log 2>/dev/null || true
            fi
          done

          echo "=== æœ€ç»ˆæ‰“åŒ…ç›®å½•å†…å®¹ ==="
          ls -lh extracted-jars/
          du -sh extracted-jars/jre extracted-jars/*.exe

          # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
          rm -rf /tmp/launch4j /tmp/launch4j.tgz /tmp/jre.zip /tmp/jdk-* /tmp/launch4j_*_config.xml
        shell: bash

      - name: 14. æ‰“åŒ…ä»…å« EXE + JRE çš„ç‹¬ç«‹è¿è¡ŒåŒ…
        run: |
          # åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œåªæ”¾å…¥ EXE å’Œ jre æ–‡ä»¶å¤¹
          mkdir -p standalone-package
          cp extracted-jars/*.exe standalone-package/ 2>/dev/null || echo "æ—  EXE æ–‡ä»¶"
          cp -r extracted-jars/jre standalone-package/ 2>/dev/null || echo "æ—  jre æ–‡ä»¶å¤¹"

          # æ‰“æˆ ZIP
          cd standalone-package
          zip -r ../WsProxy-${{ env.TAG_NAME }}-win.zip ./*
          cd ..

          echo "âœ… ç‹¬ç«‹è¿è¡ŒåŒ…æ‰“åŒ…å®Œæˆ: WsProxy-${{ env.TAG_NAME }}-win.zip"
          ls -lh WsProxy-${{ env.TAG_NAME }}-win.zip
          du -sh WsProxy-${{ env.TAG_NAME }}-win.zip

      - name: 15. ä¸Šä¼ åˆ° GitHub Releaseï¼ˆåŒ…å«ç‹¬ç«‹ EXE åŒ…ï¼‰
        uses: softprops/action-gh-release@v2
        if: ${{ inputs.push_to_github_release == true }}
        with:
          name: ${{ env.TAG_NAME }}
          tag_name: ${{ env.TAG_NAME }}
          files: |
            jars-${{ env.TAG_NAME }}.zip
            extracted-jars/*.jar
            extracted-jars/*.exe
            WsProxy-${{ env.TAG_NAME }}-win.zip        # æ–°å¢ï¼šç‹¬ç«‹è¿è¡ŒåŒ…
          body: |
            **Release ä¿¡æ¯**
            - æ ‡ç­¾: ${{ env.TAG_NAME }}
            - Java ç‰ˆæœ¬: ${{ env.JAVA_VERSION}}
            **WsProxy ${{ env.TAG_NAME }} å‘å¸ƒ**

            ### ğŸ† æ¨èä¸‹è½½ï¼ˆå®Œå…¨ç‹¬ç«‹è¿è¡Œï¼Œæ— éœ€å®‰è£… Javaï¼‰
            - **WsProxy-${{ env.TAG_NAME }}-win.zip**  
              â†’ è§£å‹åç›´æ¥åŒå‡» `.exe` æ–‡ä»¶è¿è¡Œï¼ˆå·²å†…ç½® Java è¿è¡Œæ—¶ï¼‰

            ### ğŸ“¦ å…¶ä»–æ–‡ä»¶
            - `jars-${{ env.TAG_NAME }}.zip`ï¼šåŸå§‹ JAR åŒ…
            - å•ä¸ª `.jar` æ–‡ä»¶ï¼šä¾›å¼€å‘è€…ä½¿ç”¨
            - å•ä¸ª `.exe` æ–‡ä»¶ï¼šä»… EXEï¼ˆéœ€ç³»ç»Ÿå·²å®‰è£… Java ${{ env.JAVA_VERSION}}ï¼‰

            **ç³»ç»Ÿè¦æ±‚**ï¼šWindows 10/11 x64  
            **è¿è¡Œæ–¹å¼**ï¼šæ¨èä½¿ç”¨ç‹¬ç«‹åŒ…ï¼ŒåŒå‡»å³è·‘

            å¦‚æœ‰é—®é¢˜æ¬¢è¿åé¦ˆï¼
          draft: ${{ env.DRAFT == true || false }}
          prerelease: ${{ env.PRERELEASE == true || false }}
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}

      # åœ¨æ­¥éª¤ ä¹‹åæ·»åŠ æ–°çš„ artifact ä¸Šä¼ æ­¥éª¤
      - name: Upload JAR files as artifact
        uses: actions/upload-artifact@v4
        with:
          name: jar-files
          path: extracted-jars/*.jar

      - name: ä¸Šä¼ ç‹¬ç«‹ EXE åŒ…ä½œä¸º Artifact
        uses: actions/upload-artifact@v4
        with:
          name: WsProxy-Standalone-EXE
          path: WsProxy-${{ env.TAG_NAME }}-win.zip

  build-and-push:
    if: ${{ github.event_name == 'push' || inputs.push_to_registry == true }}
    runs-on: ubuntu-latest
    needs: build-and-release  # æ·»åŠ ä¾èµ–å…³ç³»
    permissions:
      contents: read
      packages: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # ä¸‹è½½ä¹‹å‰å·¥ä½œæµçš„æ„å»ºäº§ç‰©
      - name: Download JAR artifacts
        uses: actions/download-artifact@v4
        with:
          name: jar-files
          path: ./

      - name: List downloaded files
        run: ls -la ./

      # è®¾ç½® Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # ç™»å½•åˆ° GitHub Container Registry
      - name: Log in to Container Registry
        #        if: ${{ inputs.push_to_registry == true }}
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # æå– Docker é•œåƒå…ƒæ•°æ®
      - name: Extract Docker metadata
        id: meta
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=raw,value=${{ github.ref_name }}
            type=raw,value=latest


      # æ„å»ºå¹¶æ¨é€ Docker é•œåƒ
      - name: Build and push Docker image
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./Dockerfile
          push: ${{ github.event_name == 'push' || inputs.push_to_registry == true }}
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
          build-args: |
            JAR_FILE_PATH=./*.jar

      # éªŒè¯æ„å»ºçš„é•œåƒ
      - name: Verify Docker image
        run: |
          docker images
          if [ "${{ inputs.push_to_registry == true }}" ]; then
            echo "Docker image pushed successfully"
          else
            echo "Docker image built locally only"
          fi
       
